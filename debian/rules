#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1
export DH_ALWAYS_EXCLUDE=CVS:.git

override_dh_testdir:
	helpers/makedeb.sh check_versions
	dh_testdir

override_dh_install:
	dh_install
	install -p -m 755 -d $(CURDIR)/debian/python3-oq-libs/opt/openquake
	install -p -m 755 -d $(CURDIR)/debian/python3-oq-libs/opt/openquake/bin

	export GEM_DEBIAN_INSTALL_LAYOUT=deb ; \
	helpers/whlsetup.sh -3 -b /opt/openquake/bin/python3.6 \
		-d $(CURDIR)/debian/python3-oq-libs/opt/openquake -s py -s py36
	install -p -m 755 -d $(CURDIR)/debian/python3-oq-libs/opt/openquake/lib/python3/dist-packages/openquake
	install -p -m 644 openquake/__init__.py $(CURDIR)/debian/python3-oq-libs/opt/openquake/lib/python3/dist-packages/openquake
	install -p -m 755 -d $(CURDIR)/debian/python3-oq-libs/opt/openquake/lib/python3/dist-packages/openquake/libs
	install -p -m 644 openquake/libs/__init__.py $(CURDIR)/debian/python3-oq-libs/opt/openquake/lib/python3/dist-packages/openquake/libs
	/opt/openquake/bin/python3 -m compileall $(CURDIR)/debian/python3-oq-libs/opt/openquake || true
#       Extra
	install -p -m 755 -d $(CURDIR)/debian/python3-oq-libs-extra/opt/openquake
	export GEM_DEBIAN_INSTALL_LAYOUT=deb ; \
	helpers/whlsetup.sh -3 -b /opt/openquake/bin/python3.6 \
		-n -d $(CURDIR)/debian/python3-oq-libs-extra/opt/openquake -s py36-extra
	install -p -m 644 openquake/__init__.py $(CURDIR)/debian/python3-oq-libs-extra/opt/openquake/lib/python3/dist-packages/mpl_toolkits
	/opt/openquake/bin/python3 -m compileall $(CURDIR)/debian/python3-oq-libs-extra/opt/openquake || true

override_dh_shlibdeps:
	echo "skip dh_shlibdeps"

override_dh_strip:
	echo "skip dh_strip"

%:
	dh  $@
